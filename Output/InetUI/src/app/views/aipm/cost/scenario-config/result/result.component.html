<div class="mb-3">
    <nz-collapse nzAccordion>
        <nz-collapse-panel nzHeader="Filters" nzShowArrow="false" nzActive="true">
            <form [formGroup]="form" (ngSubmit)="fetchChartData()">
                <div class="row align-items-center">
                    <div class="col-4">
                        <div class="form-group row align-items-center">
                            <label class="col-md-4 col-form-label">
                                <div>State</div>
                            </label>
                            <div class="col-md-8">
                                <nz-select formControlName="stateCode" class="form-control" style="height: auto" nzPlaceHolder="All" [nzShowArrow]="true" nzMode="multiple" nzShowSearch nzAllowClear nzBorderless [nzMaxTagCount]="2" [nzMaxTagPlaceholder]="tagPlaceHolder" (ngModelChange)="onStateSelect($event)">
                                    <nz-option *ngFor="let geoStateModel of filters?.state" [nzLabel]="geoStateModel.name" [nzValue]="geoStateModel.code"></nz-option>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group row align-items-center">
                            <label class="col-md-4 col-form-label">
                                <div>Business Area</div>
                            </label>
                            <div class="col-md-8">
                                <nz-select formControlName="businessArea" class="form-control" style="height: auto" nzPlaceHolder="All" [nzShowArrow]="true" nzMode="multiple" nzShowSearch nzAllowClear nzBorderless [nzMaxTagCount]="2" [nzMaxTagPlaceholder]="tagPlaceHolder">
                                    <nz-option *ngFor="let ba of baList" [nzLabel]="ba.areaName" [nzValue]="ba.areaCode"></nz-option>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group row align-items-center">
                            <label class="col-md-4 col-form-label">
                                <div>Project Type</div>
                            </label>
                            <div class="col-md-8">
                                <nz-select formControlName="projectTypeList" class="form-control" style="height: auto" nzPlaceHolder="All" nzMode="multiple" [nzShowArrow]="true" nzShowSearch nzAllowClear nzBorderless [nzMaxTagCount]="2" [nzMaxTagPlaceholder]="tagPlaceHolder">
                                    <nz-option *ngFor="let projectType of filters?.projectType" [nzLabel]="projectType" [nzValue]="projectType"></nz-option>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group row align-items-center">
                            <label class="col-md-4 col-form-label">
                                <div>Voltage</div>
                            </label>
                            <div class="col-md-8">
                                <nz-select formControlName="voltageList" class="form-control" style="height: auto" nzPlaceHolder="All" [nzShowArrow]="true" nzMode="multiple" nzShowSearch nzAllowClear nzBorderless [nzMaxTagCount]="2" [nzMaxTagPlaceholder]="tagPlaceHolder">
                                    <nz-option *ngFor="let voltage of filters?.voltage" [nzLabel]="voltage+'kV'" [nzValue]="voltage"></nz-option>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="form-group row align-items-center">
                            <label class="col-md-4 col-form-label">
                                <div>Scope</div>
                            </label>
                            <div class="col-md-8">
                                <nz-select formControlName="scopeList" class="form-control" style="height: auto" nzPlaceHolder="All" [nzShowArrow]="true" nzMode="multiple" nzShowSearch nzAllowClear nzBorderless [nzMaxTagCount]="2" [nzMaxTagPlaceholder]="tagPlaceHolder">
                                    <nz-option *ngFor="let scope of filters?.scope" [nzLabel]="scope.name" [nzValue]="scope.scope"></nz-option>
                                </nz-select>
                                <ng-template #tagPlaceHolder let-selectedList>and {{ selectedList.length }} more selected</ng-template>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <div style="display: flex; flex-direction: row; justify-content: flex-end;">
                            <button class=" btn btn-outline-primary mr-1" (click)="clearFilter()" type="button">Reset</button>
                            <button class=" btn btn-primary ng-star-inserted" type="submit">Search</button>
                        </div>
                    </div>
                </div>
            </form>
        </nz-collapse-panel>
    </nz-collapse>
</div>

    <!-- GENCODE:MARKER:1:START -->   

<!--===============================================================
// TEMPLATE START: gridcomponent.html.2.3.tpl
===============================================================-->
<app-tablegrid [title]="'Simulation'" 
[freezeLeftList]="SceEvalRiskAssesFinalResultSimulGridInfoCFGRule['freeze']['left']" [freezeRightList]="SceEvalRiskAssesFinalResultSimulGridInfoCFGRule['freeze']['right']"
[itemlist]="SceEvalRiskAssesFinalResultSimulGrid" [formatList]="SceEvalRiskAssesFinalResultSimulGridInfoCFGRule['format']"
[columnHeader]="SceEvalRiskAssesFinalResultSimulGridHdr" [mergeRule]="SceEvalRiskAssesFinalResultSimulGridInfoCFGRule['mergeRule']" [seq]="true" [loading]="loading"
[total]="true"
(eventTriggered)="onTableGridEvent($event)" [highlightRule]="SceEvalRiskAssesFinalResultSimulGridInfoCFGRule['highlightRule']"></app-tablegrid>

<!--===============================================================
// TEMPLATE END: gridcomponent.html.2.3.tpl
===============================================================-->

<!-- GENCODE:MARKER:1:END -->

<nz-tabset class="tab-set" nzType="card" [nzSelectedIndex]="tabId" (nzSelectChange)="onTabChange($event)">
    <nz-tab *ngFor="let item of tabs" [nzTitle]="item"> </nz-tab>
</nz-tabset>

<span [ngSwitch]="tabId">
    <p *ngSwitchCase="0">
        <ng-container *ngTemplateOutlet="dataTemplate"></ng-container>
    </p>
    <p *ngSwitchCase="1">
        <ng-container *ngTemplateOutlet="dataTemplate2"></ng-container>
    </p>
</span>


<div *ngIf="chartData?.status !== 'Completed' && !loading">
    <nz-spin nzTip="Scenario Running..."></nz-spin>
</div>

<nz-spin *ngIf="loading"></nz-spin>


<ng-template #dataTemplate2>
<div class="wrapper" *ngIf="chartData?.status === 'Completed' && !loading">
    <app-aimp-bar-chart [data]="chartData?.durationChart" chartHeight="300" chartType="horizontalBar" type="histogramScheduleFinalResult"></app-aimp-bar-chart>


    <div class="wrapper-table">
        <!-- <button class="btn btn-primary mr-1" type="button" (click)="updateDuration()">
            Save
        </button> -->
        <nz-table nzSize="small" [nzScroll]="{x:'850px'}" nzPageSize="10" #durationTable [nzData]="durationTableData" [nzFrontPagination]="true">
            <thead>
                <tr>
                    <!-- <ng-container *ngFor="let column of tableColumns">
                        <th *ngIf="column.title === 'State'" [nzSortFn]="column.sortFn" nzLeft>{{column.title}}</th>
                        <th *ngIf="column.title !== 'State' && column.title !== 'User Input'" [nzSortFn]="column.sortFn">{{column.title}}</th>
                        <th *ngIf="column.title === 'User Input'" [nzSortFn]="column.sortFn" nzRight>{{column.title}}</th>
                    </ng-container> -->
                    <th nzLeft nzWidth="15px">No.</th>
                    <ng-container *ngFor="let column of durationTableColumns">
                        <th nzLeft *ngIf="column.title == 'State' || column.title == 'Business Area' || column.title == 'Project Type' || column.title == 'Voltage' || column.title == 'Scope'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                        <th nzRight *ngIf="column.title == 'Schedule Adjustment'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                        <th *ngIf="column.title != 'State' && column.title != 'Business Area' && column.title != 'Project Type' && column.title != 'Voltage' && column.title != 'Scope' && column.title != 'Schedule Adjustment'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                    </ng-container>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of durationTable.data; let i = index;">
                    <td nzLeft>{{ ((durationTable.nzPageIndex - 1) * durationTable.nzPageSize) + i + 1 }}</td>
                    <td nzLeft>{{data.state}}</td>
                    <td nzLeft>{{data.areaName}}</td>
                    <td nzLeft>{{data.project_Type}}</td>
                    <td nzLeft>{{data.voltage_Type+'kV'}}</td>
                    <td nzLeft>{{data.scopeName}}</td>
                    <!-- <td>{{data.varName}}</td> -->
                    <td>{{data.confidence_Level_1 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_5 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_10 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_25 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_50 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_75 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_90 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_95 | number : '1.0-0'}}</td>
                    <td>{{data.confidence_Level_99 | number : '1.0-0'}}</td>
                    <td nzRight> <input [(ngModel)]="data.user_Input" nz-input 
                            type="number"
                            min="1"
                            step="1"
                            class="form-control"
                            [readonly]="!editable"
                            (keydown)="resetInterval()"
                            (focusin)="resetInterval()"
                            (focusout)="onUpdate(data, 'duration')"></td>
                </tr>

            </tbody>
        </nz-table>
    </div>
</div>
</ng-template>


<ng-template #dataTemplate>
<div class="wrapper" *ngIf="chartData?.status === 'Completed' && !loading">
    <app-aimp-bar-chart [data]="chartData.budgetChart" chartHeight="300" chartType="horizontalBar" type="histogramBudgetFinalResult"></app-aimp-bar-chart>
    
    <div class="wrapper-table">
        <!-- <button class="btn btn-primary mr-1" type="button" (click)="updateBudget()">
            Save
        </button> -->
        <nz-table nzSize="small" [nzScroll]="{x:'850px'}" nzPageSize="10" #budgetTable [nzData]="budgetTableData" [nzFrontPagination]="true">
            <thead>
                <tr>
                    <th nzLeft nzWidth="15px">No.</th>
                    <ng-container *ngFor="let column of tableColumns">
                        <th nzLeft *ngIf="column.title == 'State' || column.title == 'Business Area' || column.title == 'Project Type' || column.title == 'Voltage' || column.title == 'Scope'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                        <th nzRight *ngIf="column.title == 'Budget Adjustment (%)'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                        <th *ngIf="column.title != 'State' && column.title != 'Business Area' && column.title != 'Project Type' && column.title != 'Voltage' && column.title != 'Scope' && column.title != 'Budget Adjustment (%)'" [nzSortFn]="column.sortFn" nzWidth="{{column.columnWidth}}">{{column.title}}</th>
                    </ng-container>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of budgetTable.data; let i = index;">
                    <td nzLeft>{{ ((budgetTable.nzPageIndex - 1) * budgetTable.nzPageSize) + i + 1 }}</td>
                    <td nzLeft>{{data.state}}</td>
                    <td nzLeft>{{data.areaName}}</td>
                    <td nzLeft>{{data.project_Type}}</td>
                    <td nzLeft>{{data.voltage_Type+'kV'}}</td>
                    <td nzLeft>{{data.scopeName}}</td>
                    <!-- <td>{{data.varName}}</td> -->
                    <td>{{data.confidence_Level_1 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_5 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_10 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_25 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_50 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_75 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_90 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_95 | number : '1.1-1'}}</td>
                    <td>{{data.confidence_Level_99 | number : '1.1-1'}}</td>
                    <td nzRight> <input [(ngModel)]="data.user_Input" nz-input 
                        type="number"
                        class="form-control"
                        [readonly]="!editable"
                        (keydown)="resetInterval()"
                        (focusin)="resetInterval()"
                        (focusout)="onUpdate(data, 'budget')"></td>
                </tr>

            </tbody>
        </nz-table>
    </div>

</div>
</ng-template>